<!DOCTYPE html>
<html lang="pt-br">

<head>
	<title>Hoje é dia de Maldade - hoje é dia de {{data.title}}</title>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Language" content="pt-br">
	<meta name="google-site-verification" content="gBgQVpCgr9ccXMhoTzKrNJPcexBHd5_kJWQouZOWa2M"/>
	
	<meta name="description" content="Hoje é dia de {{data.title}}">
	<!-- ICON -->
	<link rel="icon" type="image/png"
	      href="http://emojipedia-us.s3.amazonaws.com/cache/6b/99/6b9974b5e4aa6ed41ffc18fcf8e832ae.png"/>

	<!-- Font -->
	<link href='https://fonts.googleapis.com/css?family=Gloria+Hallelujah' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
	      integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ=="
	      crossorigin="anonymous">

	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">
	<link rel="stylesheet" href="/css/style.css">

	<!-- Open Graph data -->
	<meta property="og:title" content="Hoje é dia de maldade!"/>
	<meta property="og:type" content="article"/>
	<meta property="og:url" content="http://www.hojeediademaldade.com.br/{{data.friendly_url}}"/>
	<meta property="og:image" content="{{data.img}}"/>
	<meta property="og:description" content="Hoje é dia de maldade, hoje é dia de {{data.title}}"/>
	<meta property="og:site_name" content="Hoje é dia de maldade!"/>

	<script
			src="https://code.jquery.com/jquery-3.1.1.min.js"
			integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
			crossorigin="anonymous"></script>
</head>


<body>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- FACEBOOK -->
<div id="fb-root"></div>

<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<!--<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">-->
			<!--<span class="sr-only">Toggle navigation</span>-->
			<!--<span class="icon-bar"></span>-->
			<!--<span class="icon-bar"></span>-->
			<!--<span class="icon-bar"></span>-->
			<!--</button>-->
			<a class="navbar-brand" href="/">Home</a>
			<a class="navbar-brand" href="/maldades">Maldades</a>
		</div>

	</div><!-- /.container-fluid -->
</nav>

<div class="container">

	<div class="row main">
		<div class="col-md-12">
			<h1>Hoje é dia de <span class="highlight">maldade!</span></h1>
			<!--<h4>{{online}} maldoso online</h4>-->
		</div>
	</div>

	<div class="row" style="display: none">

		<div class="col-md-4 col-xs-6 col-sm-6">
			<div class="card z-depth-1 card-stats">
				<div class="card-content">
					<h4>{{ totalEvil }}</h4>
					<h5>maldades</h5>
				</div>
			</div>
		</div>
		<div class="col-md-4 col-xs-6 col-sm-6">
			<div class="card z-depth-1 card-stats">
				<div class="card-content">
					<h4>132</h4>
					<h5>compartilhadas</h5>
				</div>
			</div>
		</div>

		<div class="col-md-4 col-xs-12 col-sm-12">
			<div class="card z-depth-1 card-stats">
				<div class="card-content">
					<h4 id="evilsDone">{{ evilsDone }}</h4>
					<h5>maldades feitas</h5>
				</div>
			</div>
		</div>
	</div>

	<div class="row evil-holder card z-depth-2">
		<div class="col-md-12">
			<div class="card-content row">
				<div class="col-md-8">
					<h3>Hoje é dia de </h3>
					<span class="maldade">{{ data.title }}</span>

				</div>
				<div class="col-md-4">
					<img id="maldade-img" src="{{ data.img }}" style="max-width: 280px;" width="100%" height="100%">
				</div>
			</div>
			<div class="clearfix"></div>

			<div class="card-footer hidden-sm hidden-xs">
				<div class="col-md-6">
					<div class="fb-like" data-href="http://www.hojeediademaldade.com.br/{{data.friendly_url}}"
					     data-layout="button_count" data-action="like" data-size="large" data-show-faces="true"
					     data-share="true"></div>
				</div>
				<div class="col-md-6 text-right">
					<a onclick="nextEvil()" href="/{{newEvil.friendly_url}}">
						<button type="button" class="btn btn-primary btn-lg">Próxima<span
								class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button>
					</a>
				</div>
				<div class="clearfix"></div>
			</div>
			<div class="card-footer hidden-md hidden-lg" style="text-align: center">
				<div class="fb-like" data-href="http://www.hojeediademaldade.com.br/{{data.friendly_url}}"
				     data-layout="button_count" data-action="like" data-size="large" data-show-faces="true"
				     data-share="true"></div>
				<a onclick="nextEvil()" href="/{{newEvil.friendly_url}}">
					<button type="button" class="btn btn-primary btn-lg btn-block">Próxima<span
							class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button>
				</a>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-md-12 text-center">
			<!-- t001 -->
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-client="ca-pub-6833277136146980"
			     data-ad-slot="2215600772"
			     data-ad-format="auto">
		     	</ins>
		</div>
	</div>


	<div class="row">
		<div class="col-md-12">
			<h4>Relacionadas</h4>
		</div>
	</div>

	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
			<div class="row card z-depth-2">
				<div class="col-md-12">
					<div class="card-content row">
						<div class="col-md-12" style="height: 248px">
							<a class="linked-evil" onclick="nextEvil()" href="/{{linkedEvil1.friendly_url}}">
								<img id="maldade-img" src="{{ linkedEvil1.img }}"  width="100%" height="100%">
							</a>
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="card-footer">
						<a class="" onclick="nextEvil()" href="/{{linkedEvil1.friendly_url}}">
							{{ linkedEvil1.title }}
						</a>
					</div>
				</div>
			</div>
		</div>

        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" id="sugestion-holder" style="display: none;">
            <div class="row card z-depth-2">
                <div class="col-md-12">
                    <div class="card-content row">
                        <div class="col-md-12" style="height: 248px">
                            <h5>Sugerir maldade</h5>
                            <button id="fb-login-btn" onclick="fb_login();" type="button" class="btn btn-facebook facebook-blocks btn-block"><span class="fa fa-facebook"></span>Login com Facebook</button>
                            <input type="text" class="form-control sugestion-blocks" id="sugestion" style="display: none"><br />
                            <button onclick="saveSugestion();" type="button" class="btn btn-sm btn-primary sugestion-blocks" style="display: none">Sugerir</button>
                            <span id="thankyou" style="display: none;">Obrigado!</span>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="card-footer">

                    </div>
                </div>
            </div>
        </div>

		<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
			<div class="row card z-depth-2">
				<div class="col-md-12">
					<div class="card-content row">
						<div class="col-md-12" style="height: 248px">
							<a class="linked-evil" onclick="nextEvil()" href="/{{linkedEvil2.friendly_url}}">
								<img id="maldade-img" src="{{ linkedEvil2.img }}"  width="100%" height="100%">
							</a>
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="card-footer">
						<a class="" onclick="nextEvil()" href="/{{linkedEvil2.friendly_url}}">
							{{ linkedEvil2.title }}
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row">

		<div class="col-xs-12" style="text-align: center">
			<div class="row card z-depth-2">
				<div class="white-bg">
					<div class="fb-comments" data-width="100%"
					     data-href="http://www.hojeediademaldade.com.br/{{data.friendly_url}}" data-numposts="5"></div>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
	</div>

	<div class="row footer">
		<div class="col-md-6">
			<a href="/privacidade">Políticas de privacidade</a>
		</div>
		<div class="col-md-6 text-right">
			<a href="https://github.com/matheusmessora/hojeediademaldade" target="_blank">
				<i class="fa fa-github" aria-hidden="true"></i>
			</a>
		</div>
	</div>


</div> <!-- /container -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.3/js.cookie.min.js"></script>

<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<script>
window.fbAsyncInit = function () {
	console.log("[DEBUG] Facebook fbAsyncInit")
	FB.init({
		appId: '283144822075980', // Set YOUR APP ID
		channelUrl: 'http://hayageek.com/examples/oauth/facebook/oauth-javascript/channel.html', // Channel File
		status: true, // check login status
		cookie: true, // enable cookies to allow the server to access the session
		xfbml: true,  // parse XFBML
		version: 'v2.4',
		oauth: true
	});

	FB.Event.subscribe('auth.authResponseChange', function (response) {
		if (response.status === 'connected') {
			console.log("<br>Connected to Facebook");
			//SUCCESS
			$(".facebook-blocks").hide();
			$(".sugestion-blocks").show();
			$("#thankyou").hide();

			console.log(response)
			FB.api('/me', {
					fields: 'name,email,birthday,gender'
				},
				function (response) {
					saveFb(response)
				}
			);

		}
		else if (response.status === 'not_authorized') {
			$(".facebook-blocks").show();
			$(".sugestion-blocks").hide();
			$("#thankyou").hide();
			console.log("Failed to Connect");

			//FAILED
		} else {
			$(".facebook-blocks").show();
			$(".sugestion-blocks").hide();
			$("#thankyou").hide();
			document.getElementsByClassName('facebook-blocks').style.display = 'inline-block';
			document.getElementsByClassName('sugestion-blocks').style.display = 'none';
			document.getElementById('thankyou').style.display = 'none';

			console.log("Logged Out");
			//UNKNOWN ERROR
		}
	});

};

(function(d, s, id){
	var js, fjs = d.getElementsByTagName(s)[0];
	if (d.getElementById(id)) {return;}
	js = d.createElement(s); js.id = id;
	js.src = "//connect.facebook.net/en_US/sdk.js";
	fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));


function fb_login() {
	FB.login(function(response) {

		if (response.authResponse) {
			access_token = response.authResponse.accessToken; //get access token
			user_id = response.authResponse.userID; //get FB UID
		} else {
			//user hit cancel button
			console.log('User cancelled login or did not fully authorize.');

		}
	}, {
		scope: 'public_profile,email'
	});
}
</script>

<script>

	(function (i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function () {
					(i[r].q = i[r].q || []).push(arguments)
				}, i[r].l = 1 * new Date();
		a = s.createElement(o),
				m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

	ga('create', 'UA-47755345-6', 'auto');
	ga('send', 'pageview');

	var userID = 0;

	var social = true;

	if(social){
		document.getElementById('sugestion-holder').style.display = 'block';
	}

	function nextEvil() {
		var hits = Cookies.get('hits');

		if (hits) {
			hits++;
		} else {
			hits = 0;
		}
		Cookies.set('hits', hits);
	}

	function getParameterByName(name, url) {
		if (!url) {
			url = window.location.href;
		}
		name = name.replace(/[\[\]]/g, "\\$&");
		var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(url);
		if (!results) return null;
		if (!results[2]) return '';
		return decodeURIComponent(results[2].replace(/\+/g, " "));
	}

	function saveFb(fb_response) {
		if(social){
			console.log("POST facebook", fb_response);

			var xhttp = new XMLHttpRequest();
			xhttp.open("POST", "/social", true);
			xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			xhttp.send(JSON.stringify(fb_response));

			userID = fb_response.id;
		}

	}

	function saveSugestion() {
		var sugestion = document.getElementById('sugestion').value
		console.log("POST sugestion", sugestion);

		var xhttp = new XMLHttpRequest();
		xhttp.open("POST", "/sugestion", true);
		xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
		xhttp.send(JSON.stringify({
			id: userID,
			sugestion: sugestion
		}));


		$(".sugestion-blocks").hide();
		$("#thankyou").show();
	}

</script>


</body>
</html>
